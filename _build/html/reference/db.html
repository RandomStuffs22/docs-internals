
<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Database Abstraction Layer &mdash; Phalcon 0.4.4 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/configurationblock.css" type="text/css" />
    <!--
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/layout.css" type="text/css" />
    -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Rosario" type="text/css">
    <!-- link rel="stylesheet" href="http://phalconphp.com/css/s.css" type="text/css" -->
    <link rel="stylesheet" href="../_static/s.css" type="text/css">    
    <link rel="stylesheet" href="../_static/docs.css" type="text/css">
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4.4',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <!--<script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>-->

    <script type="text/javascript">
    <!--
        $(document).ready(function() {
            $("#versions").change(function() {
                var docsUrl = $(this).val();
                window.location.href = docsUrl;
            });
        });
    -->
    </script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Phalcon 0.4.4 documentation" href="../index.html" />
    <link rel="next" title="Logging" href="logging.html" />
    <link rel="prev" title="Multi-lingual Support" href="translate.html" /> 
  </head>
  <body>
    <div id="wrapper">

      <div id="header">        
        <h1><a href="http://phalconphp.com/index" ><img border="0" src="../_static/img/logo-small.png"></a></h1>
        <div align="center">
          <div id="nav-main" role="navigation">
            <div class="menubar">
              <div class="nav-main-features nav-first"><a href="http://phalconphp.com/index" >HOME</a></div>
              <div class="nav-main-features nav-first"><a href="http://phalconphp.com/download" >DOWNLOAD</a></div>
              <div class="nav-main-features"><a href="http://docs.phalconphp.com" >DOCUMENTATION</a></div>
              <div class="nav-main-features"><a href="https://groups.google.com/forum/#!forum/phalcon">SUPPORT</a></div>
              <div class="nav-main-features nav-first"><a href="https://github.com/phalcon/cphalcon">GITHUB</a></div>
              <div class="nav-main-features"><a target="blog" href="http://blog.phalconphp.com/">BLOG</a></div>
            </div>
          </div>
        </div>
      </div>
    <div class="related">      
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="logging.html" title="Logging"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="translate.html" title="Multi-lingual Support"
             accesskey="P">previous</a> |</li>
        <li><a href="http://www.phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon 0.4.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="90%" align="center">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            
            <div id="searchbox" style="">
              <h3>Search</h3>
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="text" name="q" size="18">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Database Abstraction Layer</a><ul>
<li><a class="reference internal" href="#database-adapters">Database Adapters</a></li>
<li><a class="reference internal" href="#database-dialects">Database Dialects</a></li>
<li><a class="reference internal" href="#connecting-to-databases">Connecting to Databases</a></li>
<li><a class="reference internal" href="#connection-pooling">Connection Pooling</a></li>
<li><a class="reference internal" href="#finding-rows">Finding Rows</a></li>
<li><a class="reference internal" href="#binding-parameters">Binding Parameters</a></li>
<li><a class="reference internal" href="#inserting-updating-deleting-rows">Inserting/Updating/Deleting Rows</a></li>
<li><a class="reference internal" href="#profiling-sql-statements">Profiling SQL Statements</a></li>
<li><a class="reference internal" href="#logging-sql-statements">Logging SQL Statements</a><ul>
<li><a class="reference internal" href="#implementing-your-own-logger">Implementing your own Logger</a></li>
</ul>
</li>
<li><a class="reference internal" href="#describing-tables-and-databases">Describing Tables and Databases</a></li>
<li><a class="reference internal" href="#creating-altering-dropping-tables">Creating/Altering/Dropping Tables</a><ul>
<li><a class="reference internal" href="#creating-tables">Creating Tables</a></li>
<li><a class="reference internal" href="#altering-tables">Altering Tables</a></li>
<li><a class="reference internal" href="#dropping-tables">Dropping Tables</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="translate.html"
                                  title="previous chapter">Multi-lingual Support</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="logging.html"
                                  title="next chapter">Logging</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/db.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">  
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                <div class="body" >
                      
  <div class="section" id="database-abstraction-layer">
<h1>Database Abstraction Layer<a class="headerlink" href="#database-abstraction-layer" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon_Db</em></a> is the component behind <a class="reference internal" href="../api/Phalcon_Model_Base.html"><em>Phalcon_Model</em></a> that powers the model layer in the framework. It consists of an independent high-level abstraction layer for database systems completely written in C.</p>
<p>This component allows for a lower level database manipulation than using traditional models.</p>
<blockquote class="highlights">
<div>This guide is not intended to be a complete documentation of available methods and their arguments. Please visit the <a class="reference external" href="../api/index">API</a> for a complete reference.</div></blockquote>
<div class="section" id="database-adapters">
<h2>Database Adapters<a class="headerlink" href="#database-adapters" title="Permalink to this headline">¶</a></h2>
<p>This component makes use of adapters to encapsulate specific database system details. The following database engines are supported:</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="72%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
<th class="head">API</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>MySQL</td>
<td>Is the world&#8217;s most used relational database management system (RDBMS) that runs as a server providing multi-user access to a number of databases</td>
<td><a class="reference internal" href="../api/Phalcon_Db_Adapter_Mysql.html"><em>Phalcon_Db_Adapter_Mysql</em></a></td>
</tr>
<tr class="row-odd"><td>PostgreSQL</td>
<td>PostgreSQL is a powerful, open source relational database system. It has more than 15 years of active development and a proven architecture that has earned it a strong reputation for reliability, data integrity, and correctness.</td>
<td><a class="reference internal" href="../api/Phalcon_Db_Adapter_Postgresql.html"><em>Phalcon_Db_Adapter_Postgresql</em></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="database-dialects">
<h2>Database Dialects<a class="headerlink" href="#database-dialects" title="Permalink to this headline">¶</a></h2>
<p>For some database engines, PHP provides several ways to connect to it. From PDO to native drivers, Phalcon encapsulates the specific details of each database engine in dialects. Those provide common functions and SQL generator to the adapters.</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="33%" />
<col width="48%" />
<col width="11%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
<th class="head">API</th>
<th class="head">Internal Driver</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>MySQL</td>
<td>SQL specific dialect for MySQL database system</td>
<td><a class="reference internal" href="../api/Phalcon_Db_Dialect_Mysql.html"><em>Phalcon_Db_Dialect_Mysql</em></a></td>
<td>mysqli</td>
</tr>
<tr class="row-odd"><td>PostgreSQL</td>
<td>SQL specific dialect for PostgreSQL database system</td>
<td><a class="reference internal" href="../api/Phalcon_Db_Dialect_Postgresql.html"><em>Phalcon_Db_Dialect_Postgresql</em></a></td>
<td>pgsql</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="connecting-to-databases">
<h2>Connecting to Databases<a class="headerlink" href="#connecting-to-databases" title="Permalink to this headline">¶</a></h2>
<p>All the connections created by the component are factored in a single method: Phalcon_Db::factory. Its first parameter is a supported adapter, the second is a standard PHP object with the connection settings, the third parameter tells if a <a class="reference external" href="http://php.net/manual/en/features.persistent-connections.php">persistent connection</a> should be created or not. The example below shows how to create a connection passing both required and optional parameters:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Required</span>
<span class="nv">$config</span>           <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">();</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">host</span>     <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s2">&quot;mike&quot;</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s2">&quot;sigma&quot;</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">name</span>     <span class="o">=</span> <span class="s2">&quot;test_db&quot;</span><span class="p">;</span>

<span class="c1">// Optional</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">persistent</span>  <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">charset</span>     <span class="o">=</span> <span class="s2">&quot;utf8&quot;</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">collation</span>   <span class="o">=</span> <span class="s2">&quot;utf8_unicode_ci&quot;</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">compression</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

<span class="c1">// Create a connection</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="nx">Phalcon_Db</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="s2">&quot;Mysql&quot;</span><span class="p">,</span> <span class="nv">$config</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Required</span>
<span class="nv">$config</span>           <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">();</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">host</span>     <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">username</span> <span class="o">=</span> <span class="s2">&quot;postgres&quot;</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">password</span> <span class="o">=</span> <span class="s2">&quot;secret&quot;</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">name</span>     <span class="o">=</span> <span class="s2">&quot;template1&quot;</span><span class="p">;</span>

<span class="c1">// Optional</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">persistent</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="nv">$config</span><span class="o">-&gt;</span><span class="na">charset</span>    <span class="o">=</span> <span class="s2">&quot;UNICODE&quot;</span><span class="p">;</span>

<span class="c1">// Create a connection</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="nx">Phalcon_Db</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="s2">&quot;Postgresql&quot;</span><span class="p">,</span> <span class="nv">$config</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="connection-pooling">
<h2>Connection Pooling<a class="headerlink" href="#connection-pooling" title="Permalink to this headline">¶</a></h2>
<p>To control the creation of database connections through applications, a <a class="reference external" href="http://en.wikipedia.org/wiki/Connection_pool">connection pool</a> has been implemented in the framework. It caches each connection created to avoid making multiple connections to the same adapter/host/username.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$config</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s2">&quot;adapter&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;Mysql&quot;</span><span class="p">,</span>
    <span class="s2">&quot;host&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;mike&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;sigma&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;test_db&quot;</span>
<span class="p">);</span>

<span class="c1">// Set default connection settings</span>
<span class="nx">Phalcon_Db_Pool</span><span class="o">::</span><span class="na">setDefaultDescriptor</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>

<span class="c1">// Create a connection</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="nx">Phalcon_Db_Pool</span><span class="o">::</span><span class="na">getConnection</span><span class="p">();</span>

<span class="c1">// This is the same as the previous connection</span>
<span class="nv">$connection</span> <span class="o">=</span> <span class="nx">Phalcon_Db_Pool</span><span class="o">::</span><span class="na">getConnection</span><span class="p">();</span>

<span class="c1">// Passing true as parameter will renew the pooled connection</span>
<span class="nv">$connection2</span> <span class="o">=</span> <span class="nx">Phalcon_Db_Pool</span><span class="o">::</span><span class="na">getConnection</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-rows">
<h2>Finding Rows<a class="headerlink" href="#finding-rows" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon_Db</em></a> provides several methods to query rows from tables. The specific SQL syntax of the target database engine is required in this case:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT id, name FROM robots ORDER BY name&quot;</span><span class="p">;</span>

<span class="c1">// Send a SQL statement to the database system</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Print each robot name</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">())</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="nv">$robot</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Get all rows in an array</span>
<span class="nv">$robots</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$robots</span> <span class="k">as</span> <span class="nv">$robot</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="nv">$robot</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Get only the first row</span>
<span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">fetchOne</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</pre></div>
</div>
<p>By default these calls create arrays with both associative and numeric indexes. You can change this behavior by using Phalcon_Db_Result::setFetchMode(). This method receives a constant, defining which kind of index is required.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Constant</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Phalcon_Db::DB_NUM</td>
<td>Return an array with numeric indexes</td>
</tr>
<tr class="row-odd"><td>Phalcon_Db::DB_ASSOC</td>
<td>Return an array with associative indexes</td>
</tr>
<tr class="row-even"><td>Phalcon_Db::DB_BOTH</td>
<td>Return an array with both associative and numeric indexes</td>
</tr>
</tbody>
</table>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT id, name FROM robots ORDER BY name&quot;</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="nv">$result</span><span class="o">-&gt;</span><span class="na">setFetchMode</span><span class="p">(</span><span class="nx">Phalcon_Db</span><span class="o">::</span><span class="na">DB_NUM</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">())</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="nv">$robot</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The Phalcon_Db::query() returns a special object depending on the database adapter you&#8217;re using. In MySQL that object is an instance of <a class="reference internal" href="../api/Phalcon_Db_Result_Mysql.html"><em>Phalcon_Db_Result_Mysql</em></a>, while for PostgreSQL is an instance of <a class="reference internal" href="../api/Phalcon_Db_Result_Postgresql.html"><em>Phalcon_Db_Result_Postgresql</em></a>. These objects encapsulate all the functionality related to the returned resultset i.e. traversing, seeking specific records, count etc.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT id, name FROM robots&quot;</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Traverse the resultset</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">())</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="nv">$robot</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Seek to the third row</span>
<span class="nv">$result</span><span class="o">-&gt;</span><span class="na">seek</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nv">$robot</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>

<span class="c1">// Count the resultset</span>
<span class="k">echo</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">numRows</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="binding-parameters">
<h2>Binding Parameters<a class="headerlink" href="#binding-parameters" title="Permalink to this headline">¶</a></h2>
<p>Bound parameters is also supported in <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon_Db</em></a>. Although there is a minimal performance impact by using bound parameters, you are encouraged to use this methodology so as to eliminate the possibility of your code being subject to SQL injection attacks. Both string and integer placeholders are supported. Binding parameters can simply be achieved as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Binding with numeric placeholders</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM robots WHERE name = ?1 ORDER BY name&quot;</span><span class="p">;</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">bindParams</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="s2">&quot;Wall-E&quot;</span><span class="p">));</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Binding with named placeholders</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO `robots`(name`, year) VALUES (:name:, :year:)&quot;</span><span class="p">;</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">bindParams</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Astro Boy&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span> <span class="o">=&gt;</span> <span class="mi">1952</span><span class="p">));</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</pre></div>
</div>
<p>When using numeric placeholders, you will need to define them as integers i.e. 1 or 2. In this case &#8220;1&#8221; or &#8220;2&#8221; are considered strings and not numbers, so the placeholder could not be successfully replaced. With the MySQL adapter strings are automatically escaped using <a class="reference external" href="http://php.net/manual/en/mysqli.real-escape-string.php">mysqli_real_escape_string</a>. This function takes into account the connection charset, so its recommended to define the correct charset in the connection parameters or in the MySQL server configuration, as a wrong charset will produce undesired effects when storing or retrieving data.</p>
</div>
<div class="section" id="inserting-updating-deleting-rows">
<h2>Inserting/Updating/Deleting Rows<a class="headerlink" href="#inserting-updating-deleting-rows" title="Permalink to this headline">¶</a></h2>
<p>To insert, update or delete rows, you can use raw SQL or use the preset functions provided by the class:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Inserting data with a raw SQL statement</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO `robots`(`name`, `year`) VALUES (&#39;Astro Boy&#39;, 1952)&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Generating dynamically the necessary SQL</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span>
   <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
   <span class="k">array</span><span class="p">(</span><span class="s2">&quot;Astro Boy&quot;</span><span class="p">,</span> <span class="mi">1952</span><span class="p">),</span>
   <span class="k">array</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Updating data with a raw SQL statement</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE `robots` SET `name` = &#39;Astro boy&#39; WHERE `id` = 101&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Generating dynamically the necessary SQL</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span>
   <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
   <span class="k">array</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
   <span class="k">array</span><span class="p">(</span><span class="s2">&quot;New Astro Boy&quot;</span><span class="p">),</span>
   <span class="s2">&quot;id = 101&quot;</span>
<span class="p">);</span>

<span class="c1">// Deleting data with a raw SQL statement</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE `robots` WHERE `id` = 101&quot;</span><span class="p">;</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Generating dynamically the necessary SQL</span>
<span class="nv">$success</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">,</span> <span class="s2">&quot;id = 101&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="profiling-sql-statements">
<h2>Profiling SQL Statements<a class="headerlink" href="#profiling-sql-statements" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon_Db</em></a> includes a profiling component called <a class="reference internal" href="../api/Phalcon_Db_Profiler.html"><em>Phalcon_Db_Profiler</em></a>, that is used to analyze the performance of database operations so as to diagnose performance problems and discover bottlenecks.</p>
<p>Database profiling is really easy With <a class="reference internal" href="../api/Phalcon_Db_Profiler.html"><em>Phalcon_Db_Profiler</em></a>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$profiler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon_Db_Profiler</span><span class="p">();</span>

<span class="c1">// Set the connection profiler</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">setProfiler</span><span class="p">(</span><span class="nv">$profiler</span><span class="p">);</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT buyer_name, quantity, product_name &quot;</span>
     <span class="o">.</span> <span class="s2">&quot;FROM buyers &quot;</span>
     <span class="o">.</span> <span class="s2">&quot;LEFT JOIN products ON buyers.pid = products.id&quot;</span><span class="p">;</span>

<span class="c1">// Execute a SQL statement</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

<span class="c1">// Get the last profile in the profiler</span>
<span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$profiler</span><span class="o">-&gt;</span><span class="na">getLastProfile</span><span class="p">();</span>

<span class="k">echo</span> <span class="s2">&quot;SQL Statement: &quot;</span><span class="p">,</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getSQLStatement</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;Start Time: &quot;</span><span class="p">,</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getInitialTime</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;Final Time: &quot;</span><span class="p">,</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getFinalTime</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;Total Elapsed Time: &quot;</span><span class="p">,</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getTotalElapsedSeconds</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>You can also create your own profile class based on <a class="reference internal" href="../api/Phalcon_Db_Profiler.html"><em>Phalcon_Db_Profiler</em></a> to record real time statistics of the statements sent to the database system:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">DbProfiler</span> <span class="k">extends</span> <span class="nx">Phalcon_Db_Profiler</span>
<span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">    * Executed before the SQL statement is sent to the db server</span>
<span class="sd">    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">beforeStartProfile</span><span class="p">(</span><span class="nx">Phalcon_Db_Profiler_Item</span> <span class="nv">$profile</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getSQLStatement</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">    * Executed after the SQL statement is sent to the db server</span>
<span class="sd">    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">afterEndProfile</span><span class="p">(</span><span class="nx">Phalcon_Db_Profiler_Item</span> <span class="nv">$profile</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getTotalElapsedSeconds</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="logging-sql-statements">
<h2>Logging SQL Statements<a class="headerlink" href="#logging-sql-statements" title="Permalink to this headline">¶</a></h2>
<p>Using high-level abstraction components such as <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon_Db</em></a> to access a database, it is difficult to understand which statements are sent to the database system. <a class="reference internal" href="../api/Phalcon_Logger.html"><em>Phalcon_Logger</em></a> interacts with <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon_Db</em></a>, providing logging capabilities on the database abstraction layer.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon_Logger</span><span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;app/logs/db.log&quot;</span><span class="p">);</span>

<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">setLogger</span><span class="p">(</span><span class="nv">$logger</span><span class="p">);</span>

<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span>
    <span class="s2">&quot;products&quot;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s2">&quot;Hot pepper&quot;</span><span class="p">,</span> <span class="mf">3.50</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>As above, the file <em>app/logs/db.log</em> will contain something like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">[Sun, 29 Apr 12 22:35:26 -0500][DEBUG][Resource Id #77] INSERT INTO products (name, price) VALUES (&#39;Hot pepper&#39;, 3.50)</span>
</pre></div>
</div>
<div class="section" id="implementing-your-own-logger">
<h3>Implementing your own Logger<a class="headerlink" href="#implementing-your-own-logger" title="Permalink to this headline">¶</a></h3>
<p>You can implement your own logger class for database queries, by creating a class that implements a single method called &#8220;log&#8221;. The method needs to accept a string as the first argument. You can then pass your logging object to Phalcon_Db::setLogger(), and from then on any SQL statement executed will call that method to log the results.</p>
</div>
</div>
<div class="section" id="describing-tables-and-databases">
<h2>Describing Tables and Databases<a class="headerlink" href="#describing-tables-and-databases" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon_Db</em></a> also provides methods to retrieve detailed information about tables and databases.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Get tables on the test_db database</span>
<span class="nv">$tables</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">listTables</span><span class="p">(</span><span class="s2">&quot;test_db&quot;</span><span class="p">);</span>

<span class="c1">// Is there a table robots in the database?</span>
<span class="nv">$exists</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">tableExists</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>

<span class="c1">// Get name, data types and special features of robots fields</span>
<span class="nv">$fields</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">describeTable</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$fields</span> <span class="k">as</span> <span class="nv">$field</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">echo</span> <span class="s2">&quot;Column Type: &quot;</span><span class="p">,</span> <span class="nv">$field</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Get indexes on the robots table</span>
<span class="nv">$indexes</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">describeIndexes</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$indexes</span> <span class="k">as</span> <span class="nv">$index</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$index</span><span class="o">-&gt;</span><span class="na">getColumns</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">// Get foreign keys on the robots table</span>
<span class="nv">$references</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">describeReferences</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$references</span> <span class="k">as</span> <span class="nv">$reference</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Print referenced columns</span>
  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$reference</span><span class="o">-&gt;</span><span class="na">getReferencedColumns</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A table description is very similar to the MySQL describe command, it contains the following information:</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Index</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Field</td>
<td>Field&#8217;s name</td>
</tr>
<tr class="row-odd"><td>Type</td>
<td>Column Type</td>
</tr>
<tr class="row-even"><td>Key</td>
<td>Is the column part of the primary key or an index?</td>
</tr>
<tr class="row-odd"><td>Null</td>
<td>Does the column allow null values?</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="creating-altering-dropping-tables">
<h2>Creating/Altering/Dropping Tables<a class="headerlink" href="#creating-altering-dropping-tables" title="Permalink to this headline">¶</a></h2>
<p>Different database systems (MySQL, Postgresql etc.) offer the ability to create, alter or drop tables with the use of commands such as CREATE, ALTER or DROP. The SQL syntax differs based on which database system is used. <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon_Db</em></a> offers a unified interface to alter tables, without the need to differentiate the SQL syntax based on the target storage system.</p>
<div class="section" id="creating-tables">
<h3>Creating Tables<a class="headerlink" href="#creating-tables" title="Permalink to this headline">¶</a></h3>
<p>The following example shows how to create a table:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon_Db_Column</span> <span class="k">as</span> <span class="nx">Column</span><span class="p">;</span>

<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">createTable</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="k">null</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
       <span class="s2">&quot;columns&quot;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
                <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                <span class="k">array</span><span class="p">(</span>
                    <span class="s2">&quot;type&quot;</span>          <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_INTEGER</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span>          <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
                    <span class="s2">&quot;notNull&quot;</span>       <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                    <span class="s2">&quot;autoIncrement&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="k">array</span><span class="p">(</span>
                    <span class="s2">&quot;type&quot;</span>    <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_VARCHAR</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span>    <span class="o">=&gt;</span> <span class="mi">70</span><span class="p">,</span>
                    <span class="s2">&quot;notNull&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
                <span class="s2">&quot;year&quot;</span><span class="p">,</span>
                <span class="k">array</span><span class="p">(</span>
                    <span class="s2">&quot;type&quot;</span>    <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_INTEGER</span><span class="p">,</span>
                    <span class="s2">&quot;size&quot;</span>    <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span>
                    <span class="s2">&quot;notNull&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Phalcon_Db::createTable() accepts an associative array describing the table. Columns are defined with the class <a class="reference internal" href="../api/Phalcon_Db_Column.html"><em>Phalcon_Db_Column</em></a>. The table below shows the options available to define a column:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="84%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Description</th>
<th class="head">Optional</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;type&#8221;</td>
<td>Column type. Must be a Phalcon_Db_Column constant (see below for a list)</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>&#8220;size&#8221;</td>
<td>Some type of columns like VARCHAR or INTEGER may have a specific size</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;scale&#8221;</td>
<td>DECIMAL or NUMBER columns may be have a scale to specify how many decimals should be stored</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>&#8220;unsigned&#8221;</td>
<td>INTEGER columns may be signed or unsigned. This option does not apply to other types of columns</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;notNull&#8221;</td>
<td>Column can store null values?</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>&#8220;autoIncrement&#8221;</td>
<td>With this attribute column will filled automatically with an auto-increment integer. Only one column in the table can have this attribute.</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;first&#8221;</td>
<td>Column must be placed at first position in the column order</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>&#8220;after&#8221;</td>
<td>Column must be placed after indicated column</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>Phalcon_Db supports the following database column types:</p>
<ul class="simple">
<li>Phalcon_Db_Column::TYPE_INTEGER</li>
<li>Phalcon_Db_Column::TYPE_DATE</li>
<li>Phalcon_Db_Column::TYPE_VARCHAR</li>
<li>Phalcon_Db_Column::TYPE_DECIMAL</li>
<li>Phalcon_Db_Column::TYPE_DATETIME</li>
<li>Phalcon_Db_Column::TYPE_CHAR</li>
<li>Phalcon_Db_Column::TYPE_TEXT</li>
</ul>
<p>The associative array passed in Phalcon_Db::createTable() can have the possible keys:</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="85%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Index</th>
<th class="head">Description</th>
<th class="head">Optional</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;columns&#8221;</td>
<td>An array with a set of table columns defined with <a class="reference internal" href="../api/Phalcon_Db_Column.html"><em>Phalcon_Db_Column</em></a></td>
<td>No</td>
</tr>
<tr class="row-odd"><td>&#8220;indexes&#8221;</td>
<td>An array with a set of table indexes defined with <a class="reference internal" href="../api/Phalcon_Db_Index.html"><em>Phalcon_Db_Index</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>&#8220;references&#8221;</td>
<td>An array with a set of table references (foreign keys) defined with <a class="reference internal" href="../api/Phalcon_Db_Reference.html"><em>Phalcon_Db_Reference</em></a></td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>&#8220;options&#8221;</td>
<td>An array with a set of table creation options. These options often relate to the database system in which the migration was generated.</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="altering-tables">
<h3>Altering Tables<a class="headerlink" href="#altering-tables" title="Permalink to this headline">¶</a></h3>
<p>As your application grows, you might need to alter your database, as part of a refactoring or adding new features. Not all database systems allow to modify existing columns or add columns between two existing ones. <a class="reference internal" href="../api/Phalcon_Db.html"><em>Phalcon_Db</em></a> is limited by these constraints.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon_Db_Column</span> <span class="k">as</span> <span class="nx">Column</span><span class="p">;</span>

<span class="c1">// Adding a new column</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">addColumn</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="k">null</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
        <span class="s2">&quot;robot_type&quot;</span><span class="p">,</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s2">&quot;type&quot;</span>    <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_VARCHAR</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span>    <span class="o">=&gt;</span> <span class="mi">32</span><span class="p">,</span>
            <span class="s2">&quot;notNull&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
            <span class="s2">&quot;after&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Modifying an existing column</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">modifyColumn</span><span class="p">(</span>
    <span class="s2">&quot;robots&quot;</span><span class="p">,</span>
    <span class="k">null</span><span class="p">,</span>
    <span class="k">new</span> <span class="nx">Column</span><span class="p">(</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s2">&quot;type&quot;</span> <span class="o">=&gt;</span> <span class="nx">Column</span><span class="o">::</span><span class="na">TYPE_VARCHAR</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span> <span class="o">=&gt;</span> <span class="mi">40</span><span class="p">,</span>
            <span class="s2">&quot;notNull&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Deleting the column &quot;name&quot;</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">deleteColumn</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="dropping-tables">
<h3>Dropping Tables<a class="headerlink" href="#dropping-tables" title="Permalink to this headline">¶</a></h3>
<p>Examples on dropping tables:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="c1">// Drop table robot from active database</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">dropTable</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">);</span>

<span class="c1">//Drop table robot from database &quot;machines&quot;</span>
<span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">dropTable</span><span class="p">(</span><span class="s2">&quot;robots&quot;</span><span class="p">,</span> <span class="s2">&quot;machines&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


                    </div>
                  </div>
                </div>          
            </div>
          </td>  
        </tr>   
      </table>
    <div class="related">      
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="logging.html" title="Logging"
             >next</a> |</li>
        <li class="right" >
          <a href="translate.html" title="Multi-lingual Support"
             >previous</a> |</li> 
      </ul>
    </div>
        <div id="footer">
             &copy; Copyright 2012, Phalcon Team.
             Last updated on Aug 30, 2012.
            Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
        </div>

    </div>

  </body>
</html>