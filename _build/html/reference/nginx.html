
<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Nginx Installation Notes &mdash; Phalcon 0.4.4 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/configurationblock.css" type="text/css" />
    <!--
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/layout.css" type="text/css" />
    -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Rosario" type="text/css">
    <!-- link rel="stylesheet" href="http://phalconphp.com/css/s.css" type="text/css" -->
    <link rel="stylesheet" href="../_static/s.css" type="text/css">    
    <link rel="stylesheet" href="../_static/docs.css" type="text/css">
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4.4',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <!--<script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>-->

    <script type="text/javascript">
    <!--
        $(document).ready(function() {
            $("#versions").change(function() {
                var docsUrl = $(this).val();
                window.location.href = docsUrl;
            });
        });
    -->
    </script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Phalcon 0.4.4 documentation" href="../index.html" />
    <link rel="up" title="Installation" href="install.html" />
    <link rel="next" title="Tutorial: Let’s learn by example" href="tutorial.html" />
    <link rel="prev" title="Installation on WAMP" href="wamp.html" /> 
  </head>
  <body>
    <div id="wrapper">

      <div id="header">        
        <h1><a href="http://phalconphp.com/index" ><img border="0" src="../_static/img/logo-small.png"></a></h1>
        <div align="center">
          <div id="nav-main" role="navigation">
            <div class="menubar">
              <div class="nav-main-features nav-first"><a href="http://phalconphp.com/index" >HOME</a></div>
              <div class="nav-main-features nav-first"><a href="http://phalconphp.com/download" >DOWNLOAD</a></div>
              <div class="nav-main-features"><a href="http://docs.phalconphp.com" >DOCUMENTATION</a></div>
              <div class="nav-main-features"><a href="https://groups.google.com/forum/#!forum/phalcon">SUPPORT</a></div>
              <div class="nav-main-features nav-first"><a href="https://github.com/phalcon/cphalcon">GITHUB</a></div>
              <div class="nav-main-features"><a target="blog" href="http://blog.phalconphp.com/">BLOG</a></div>
            </div>
          </div>
        </div>
      </div>
    <div class="related">      
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial.html" title="Tutorial: Let’s learn by example"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="wamp.html" title="Installation on WAMP"
             accesskey="P">previous</a> |</li>
        <li><a href="http://www.phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon 0.4.4 documentation</a> &raquo;</li>
          <li><a href="install.html" accesskey="U">Installation</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="90%" align="center">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            
            <div id="searchbox" style="">
              <h3>Search</h3>
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="text" name="q" size="18">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Nginx Installation Notes</a><ul>
<li><a class="reference internal" href="#configuring-nginx-for-phalcon">Configuring Nginx for Phalcon</a><ul>
<li><a class="reference internal" href="#dedicated-instance">Dedicated Instance</a></li>
<li><a class="reference internal" href="#configuration-by-host">Configuration by Host</a></li>
</ul>
</li>
<li><a class="reference internal" href="#preparing-phalcon-to-nginx">Preparing Phalcon to Nginx</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="wamp.html"
                                  title="previous chapter">Installation on WAMP</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="tutorial.html"
                                  title="next chapter">Tutorial: Let&#8217;s learn by example</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/nginx.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">  
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                <div class="body" >
                      
  <div class="section" id="nginx-installation-notes">
<h1>Nginx Installation Notes<a class="headerlink" href="#nginx-installation-notes" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://wiki.nginx.org/Main">Nginx</a> is a free, open-source, high-performance HTTP server and reverse proxy, as well as an IMAP/POP3 proxy server. Unlike traditional servers, <a class="reference external" href="http://wiki.nginx.org/Main">Nginx</a> doesn&#8217;t rely on threads to handle requests. Instead it uses a much more scalable event-driven (asynchronous) architecture. This architecture uses small, but more importantly, predictable amounts of memory under load.</p>
<p>The <a class="reference external" href="http://php-fpm.org/">PHP-FPM</a> (FastCGI Process Manager) is usually used to allow <a class="reference external" href="http://wiki.nginx.org/Main">Nginx</a> to process PHP files. Nowadays, <a class="reference external" href="http://php-fpm.org/">PHP-FPM</a> is bundled with any Unix PHP distribution. Phalcon + <a class="reference external" href="http://wiki.nginx.org/Main">Nginx</a> + <a class="reference external" href="http://php-fpm.org/">PHP-FPM</a> provides a powerful set of tools that offer maximum performance for your PHP applications.</p>
<div class="section" id="configuring-nginx-for-phalcon">
<h2>Configuring Nginx for Phalcon<a class="headerlink" href="#configuring-nginx-for-phalcon" title="Permalink to this headline">¶</a></h2>
<p>The following are potential configurations you can use to setup nginx with Phalcon.</p>
<div class="section" id="dedicated-instance">
<h3>Dedicated Instance<a class="headerlink" href="#dedicated-instance" title="Permalink to this headline">¶</a></h3>
<div class="highlight-nginx"><div class="highlight"><pre><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span>       <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span>  <span class="s">localhost</span><span class="p">;</span>

    <span class="kn">charset</span>      <span class="s">utf-8</span><span class="p">;</span>

    <span class="c1">#access_log  /var/log/nginx/host.access.log  main;</span>

    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">root</span>   <span class="s">/srv/www/htdocs/phalcon-website/public</span><span class="p">;</span>
        <span class="kn">index</span>  <span class="s">index.php</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>

        <span class="c1"># if file exists return it right away</span>
        <span class="kn">if</span> <span class="s">(-f</span> <span class="nv">$request_filename</span><span class="s">)</span> <span class="p">{</span>
            <span class="kn">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1"># otherwise rewrite it</span>
        <span class="kn">if</span> <span class="s">(!-e</span> <span class="nv">$request_filename</span><span class="s">)</span> <span class="p">{</span>
            <span class="kn">rewrite</span> <span class="s">^(.+)</span>$ <span class="s">/index.php?_url=</span><span class="nv">$1</span> <span class="s">last</span><span class="p">;</span>
        <span class="kn">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php</span> <span class="p">{</span>
        <span class="c1"># try_files    $uri =404;</span>

        <span class="kn">fastcgi_index</span>  <span class="s">/index.php</span><span class="p">;</span>
        <span class="kn">fastcgi_pass</span>   <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">9000</span><span class="p">;</span>

        <span class="kn">include</span> <span class="s">fastcgi_params</span><span class="p">;</span>
        <span class="kn">fastcgi_split_path_info</span>       <span class="s">^(.+\.php)(/.+)</span>$<span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">PATH_INFO</span>       <span class="nv">$fastcgi_path_info</span><span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">PATH_TRANSLATED</span> <span class="nv">$document_root$fastcgi_path_info</span><span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">SCRIPT_FILENAME</span> <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">^/(css|img|js|flv|swf|download)/(.+)</span>$ <span class="p">{</span>
        <span class="kn">root</span> <span class="nv">$root_path</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-by-host">
<h3>Configuration by Host<a class="headerlink" href="#configuration-by-host" title="Permalink to this headline">¶</a></h3>
<p>And this second configuration allow you to have different configurations by host:</p>
<div class="highlight-nginx"><div class="highlight"><pre><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span>      <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
    <span class="kn">set</span>         <span class="nv">$root_path</span> <span class="s">&#39;/var/www/</span><span class="nv">$host/public&#39;</span><span class="p">;</span>
    <span class="kn">root</span>        <span class="nv">$root_path</span><span class="p">;</span>

    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/</span><span class="nv">$host-access.log</span><span class="p">;</span>
    <span class="kn">error_log</span>   <span class="s">/var/log/nginx/</span><span class="nv">$host-error.log</span> <span class="s">error</span><span class="p">;</span>

    <span class="kn">index</span> <span class="s">index.php</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>

    <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">@rewrite</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">@rewrite</span> <span class="p">{</span>
        <span class="kn">rewrite</span> <span class="s">^/(.*)</span>$ <span class="s">/index.php?_url=</span><span class="nv">$1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php</span> <span class="p">{</span>
        <span class="c1"># try_files    $uri =404;</span>

        <span class="kn">fastcgi_index</span>  <span class="s">/index.php</span><span class="p">;</span>
        <span class="kn">fastcgi_pass</span>   <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">9000</span><span class="p">;</span>

        <span class="kn">include</span> <span class="s">fastcgi_params</span><span class="p">;</span>
        <span class="kn">fastcgi_split_path_info</span>       <span class="s">^(.+\.php)(/.+)</span>$<span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">PATH_INFO</span>       <span class="nv">$fastcgi_path_info</span><span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">PATH_TRANSLATED</span> <span class="nv">$document_root$fastcgi_path_info</span><span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">SCRIPT_FILENAME</span> <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">^/(css|img|js|flv|swf|download)/(.+)</span>$ <span class="p">{</span>
        <span class="kn">root</span> <span class="nv">$root_path</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="p">~</span> <span class="sr">/\.ht</span> <span class="p">{</span>
        <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="preparing-phalcon-to-nginx">
<h2>Preparing Phalcon to Nginx<a class="headerlink" href="#preparing-phalcon-to-nginx" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;re using the default <a class="reference internal" href="../api/Phalcon_Router_Rewrite.html"><em>Phalcon_Router_Rewrite</em></a> router, you will notice that <a class="reference external" href="http://wiki.nginx.org/Main">Nginx</a> puts a slash (/) at the beggining of the $_GET[&#8216;_url&#8217;]. Is necessary to remove the URL for a proper operation of the router.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;_url&quot;</span><span class="p">])){</span>
        <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;#^/#&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;_url&quot;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="nv">$front</span> <span class="o">=</span> <span class="nx">Phalcon_Controller_Front</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>

    <span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon_Config_Adapter_Ini</span><span class="p">(</span><span class="s2">&quot;../app/config/config.ini&quot;</span><span class="p">);</span>
    <span class="nv">$front</span><span class="o">-&gt;</span><span class="na">setConfig</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>

    <span class="k">echo</span> <span class="nv">$front</span><span class="o">-&gt;</span><span class="na">dispatchLoop</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Phalcon_Exception</span> <span class="nv">$e</span><span class="p">){</span>
    <span class="k">echo</span> <span class="s2">&quot;PhalconException: &quot;</span><span class="p">,</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


                    </div>
                  </div>
                </div>          
            </div>
          </td>  
        </tr>   
      </table>
    <div class="related">      
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial.html" title="Tutorial: Let’s learn by example"
             >next</a> |</li>
        <li class="right" >
          <a href="wamp.html" title="Installation on WAMP"
             >previous</a> |</li>
          <li><a href="install.html" >Installation</a> &raquo;</li> 
      </ul>
    </div>
        <div id="footer">
             &copy; Copyright 2012, Phalcon Team.
             Last updated on Aug 30, 2012.
            Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
        </div>

    </div>

  </body>
</html>