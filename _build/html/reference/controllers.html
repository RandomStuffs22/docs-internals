
<!DOCTYPE html>

<html lang="en">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using Controllers &mdash; Phalcon 0.4.4 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/configurationblock.css" type="text/css" />
    <!--
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/layout.css" type="text/css" />
    -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Rosario" type="text/css">
    <!-- link rel="stylesheet" href="http://phalconphp.com/css/s.css" type="text/css" -->
    <link rel="stylesheet" href="../_static/s.css" type="text/css">    
    <link rel="stylesheet" href="../_static/docs.css" type="text/css">
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4.4',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <!--<script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>-->

    <script type="text/javascript">
    <!--
        $(document).ready(function() {
            $("#versions").change(function() {
                var docsUrl = $(this).val();
                window.location.href = docsUrl;
            });
        });
    -->
    </script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Phalcon 0.4.4 documentation" href="../index.html" />
    <link rel="next" title="Working with Models" href="models.html" />
    <link rel="prev" title="The MVC Architecture" href="mvc.html" /> 
  </head>
  <body>
    <div id="wrapper">

      <div id="header">        
        <h1><a href="http://phalconphp.com/index" ><img border="0" src="../_static/img/logo-small.png"></a></h1>
        <div align="center">
          <div id="nav-main" role="navigation">
            <div class="menubar">
              <div class="nav-main-features nav-first"><a href="http://phalconphp.com/index" >HOME</a></div>
              <div class="nav-main-features nav-first"><a href="http://phalconphp.com/download" >DOWNLOAD</a></div>
              <div class="nav-main-features"><a href="http://docs.phalconphp.com" >DOCUMENTATION</a></div>
              <div class="nav-main-features"><a href="https://groups.google.com/forum/#!forum/phalcon">SUPPORT</a></div>
              <div class="nav-main-features nav-first"><a href="https://github.com/phalcon/cphalcon">GITHUB</a></div>
              <div class="nav-main-features"><a target="blog" href="http://blog.phalconphp.com/">BLOG</a></div>
            </div>
          </div>
        </div>
      </div>
    <div class="related">      
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="models.html" title="Working with Models"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mvc.html" title="The MVC Architecture"
             accesskey="P">previous</a> |</li>
        <li><a href="http://www.phalconphp.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon 0.4.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

      <table width="90%" align="center">
        <tr>
      <td class="primary-box" width="25%" valign="top">
            
            <div id="searchbox" style="">
              <h3>Search</h3>
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="text" name="q" size="18">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:">
                </form>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Using Controllers</a><ul>
<li><a class="reference internal" href="#dispatch-loop">Dispatch Loop</a></li>
<li><a class="reference internal" href="#initializing-controllers">Initializing Controllers</a></li>
<li><a class="reference internal" href="#dispatch-events">Dispatch Events</a></li>
<li><a class="reference internal" href="#request-and-response">Request and Response</a></li>
<li><a class="reference internal" href="#session-data">Session Data</a></li>
<li><a class="reference internal" href="#controller-environment">Controller Environment</a></li>
<li><a class="reference internal" href="#creating-a-base-controller">Creating a Base Controller</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="mvc.html"
                                  title="previous chapter">The MVC Architecture</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="models.html"
                                  title="next chapter">Working with Models</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/controllers.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
        </td>
          <td class="second-box" valign="top">  
            <div class="document">
                <div class="documentwrapper">
                  <div class="bodywrapper">
                <div class="body" >
                      
  <div class="section" id="using-controllers">
<h1>Using Controllers<a class="headerlink" href="#using-controllers" title="Permalink to this headline">¶</a></h1>
<p>The controllers provide a number of methods that are called actions. Actions are methods on a controller that handle requests. By default all public methods on a controller map to actions and are accessible by a URL. Actions are responsible for interpreting the request and creating the response. Usually responses are in the form of a rendered view, but there are other ways to create responses as well.</p>
<p>For instance, when you access a URL like this: <a class="reference external" href="http://localhost/blog/posts/show/2012/the-post-title">http://localhost/blog/posts/show/2012/the-post-title</a> Phalcon by default will decompose each part like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="60%" />
<col width="40%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Phalcon Directory</strong></td>
<td>blog</td>
</tr>
<tr class="row-even"><td><strong>Controller</strong></td>
<td>posts</td>
</tr>
<tr class="row-odd"><td><strong>Action</strong></td>
<td>show</td>
</tr>
<tr class="row-even"><td><strong>Parameter</strong></td>
<td>2012</td>
</tr>
<tr class="row-odd"><td><strong>Parameter</strong></td>
<td>the-post-title</td>
</tr>
</tbody>
</table>
<p>In this case, the PostsController will handle this request. The controller file will be located in the controllers directory. Controllers must have the suffix &#8220;Controller&#8221; while actions the suffix &#8220;Action&#8221;. A sample of a controller is as follows:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PostsController</span> <span class="k">extends</span> <span class="nx">Phalcon_Controller</span>
<span class="p">{</span>

    <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$year</span><span class="p">,</span> <span class="nv">$postTitle</span><span class="p">)</span>
    <span class="p">{</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Additional URI parameters are defined as action parameters, so that they can be easily accessed using local variables.</p>
<div class="section" id="dispatch-loop">
<h2>Dispatch Loop<a class="headerlink" href="#dispatch-loop" title="Permalink to this headline">¶</a></h2>
<p>The dispatch loop will be executed within the Dispatcher until there are no actions left to be executed. In the previous example only one action was executed. Now we&#8217;ll see how _forward can provide a more complex flow of operation in the dispatch loop, by forwarding execution to a different controller/action.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PostsController</span> <span class="k">extends</span> <span class="nx">Phalcon_Controller</span>
<span class="p">{</span>

    <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$year</span><span class="p">,</span> <span class="nv">$postTitle</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">Phalcon_Flash</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;You don&#39;t have permission to access this area&quot;</span><span class="p">);</span>

        <span class="c1">// Forward flow to another action</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_forward</span><span class="p">(</span><span class="s2">&quot;users/signin&quot;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>If users don&#8217;t have permissions to access a certain action then will be forwarded to the Users controller, signin action.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">UsersController</span> <span class="k">extends</span> <span class="nx">Phalcon_Controller</span>
<span class="p">{</span>

    <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">signinAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>There is no limit on the &#8220;forwards&#8221; you can have in your application, so long as they do not result in circular references, at which point your application will halt. If there are no other actions to be dispatched by the dispatch loop, the dispatcher will automatically invoke the view layer of the MVC which is managed by <a class="reference internal" href="../api/Phalcon_View.html"><em>Phalcon_View</em></a>.</p>
</div>
<div class="section" id="initializing-controllers">
<h2>Initializing Controllers<a class="headerlink" href="#initializing-controllers" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Controller.html"><em>Phalcon_Controller</em></a> offers the initialize method, which is executed first, before any action is executed on a controller. The use of the &#8220;__construct&#8221; method is not recommended.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PostsController</span> <span class="k">extends</span> <span class="nx">Phalcon_Controller</span>
<span class="p">{</span>

    <span class="k">function</span> <span class="nf">initialize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s2">&quot;mySetting&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;value&quot;</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">saveAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">[</span><span class="s2">&quot;mySetting&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//...</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="dispatch-events">
<h2>Dispatch Events<a class="headerlink" href="#dispatch-events" title="Permalink to this headline">¶</a></h2>
<p>Events enable controllers to run shared pre- and post- processing code for their actions. Every time a controller action is executed, two events are executed to check security conditions, modify application control flow or data. These events are &#8220;beforeDispatch&#8221; and &#8220;afterDispatch&#8221;. The first one is executed before the controller action is dispatched. Developers can change the control flow by using a forward in that event. The second one is the &#8220;afterDispatch&#8221; event, which is executed after the controller action.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PostsController</span> <span class="k">extends</span> <span class="nx">Phalcon_Controller</span>
<span class="p">{</span>

    <span class="k">function</span> <span class="nf">beforeDispatch</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Phalcon_Session</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;hasAuth&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Check whether user is authenticated and forwards him to login if not</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_forward</span><span class="p">(</span><span class="s2">&quot;session/login&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="request-and-response">
<h2>Request and Response<a class="headerlink" href="#request-and-response" title="Permalink to this headline">¶</a></h2>
<p>In every controller there are two public properties pointing to the request and the response objects associated with the request cycle that is currently in execution. The &#8220;request&#8221; attribute contains an instance of <a class="reference internal" href="../api/Phalcon_Request.html"><em>Phalcon_Request</em></a> and the &#8220;response&#8221; attribute contains a <a class="reference internal" href="../api/Phalcon_Response.html"><em>Phalcon_Response</em></a> representing what is going to be sent back to the client.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PostsController</span> <span class="k">extends</span> <span class="nx">Phalcon_Controller</span>
<span class="p">{</span>

    <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">saveAction</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="c1">// Check if request has made with POST</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">()</span> <span class="o">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Access POST data</span>
            <span class="nv">$customerName</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">);</span>
            <span class="nv">$customerBorn</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s2">&quot;born&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The response object is not usually used directly, but is built up before the execution of the action, sometimes - like in an afterDispatch event - it can be useful to access the response directly:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PostsController</span> <span class="k">extends</span> <span class="nx">Phalcon_Controller</span>
<span class="p">{</span>

    <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">notFoundAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Send a HTTP 404 response header</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">response</span><span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">&quot;Not Found&quot;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Learn more about the request environment in its <a class="reference external" href="request.html">documentation article</a>.</p>
</div>
<div class="section" id="session-data">
<h2>Session Data<a class="headerlink" href="#session-data" title="Permalink to this headline">¶</a></h2>
<p>Sessions help us maintain persistent data between requests. You could access a <a class="reference internal" href="../api/Phalcon_Session_Namespace.html"><em>Phalcon_Session_Namespace</em></a> from any controller to encapsulate data that need to be persistent.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Phalcon_Controller</span>
<span class="p">{</span>

    <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Michael&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">welcomeAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;Welcome, &quot;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="controller-environment">
<h2>Controller Environment<a class="headerlink" href="#controller-environment" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/Phalcon_Controller.html"><em>Phalcon_Controller</em></a> provides some useful public attributes to interact with other active parts of the framework. Check out the API to understand and use all the available properties related to each component, so that you can use them in your actions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="60%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Component</th>
<th class="head">Description</th>
<th class="head">Attribute</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="../api/Phalcon_Request.html"><em>Phalcon_Request</em></a></td>
<td>Encapsulate the request information, such as HTTP method, POST and GET variables, POST files, languages, charsets, etc.</td>
<td>$this-&gt;request</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="../api/Phalcon_Response.html"><em>Phalcon_Response</em></a></td>
<td>Encapsulate the response information, such as response headers, response body, etc.</td>
<td>$this-&gt;response</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../api/Phalcon_View.html"><em>Phalcon_View</em></a></td>
<td>Encapsulate the view that will be displayed to the used</td>
<td>$this-&gt;view</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="../api/Phalcon_Dispatcher.html"><em>Phalcon_Dispatcher</em></a></td>
<td>Encapsulate details of the dispatching process</td>
<td>$this-&gt;dispatcher</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../api/Phalcon_Model_Manager.html"><em>Phalcon_Model_Manager</em></a></td>
<td>Encapsulate the models initialization, meta-data, etc</td>
<td>$this-&gt;model</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="creating-a-base-controller">
<h2>Creating a Base Controller<a class="headerlink" href="#creating-a-base-controller" title="Permalink to this headline">¶</a></h2>
<p>Some application features like access control lists, translation, cache, and template engines are often common to many controllers. In cases like these the creation of a &#8220;base controller&#8221; is encouraged to ensure your code stays <a class="reference external" href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a>. A base controller is simply a class that extends the <a class="reference internal" href="../api/Phalcon_Controller.html"><em>Phalcon_Controller</em></a> and encapsulates the common functionality that all controllers must have. In turn, your controllers extend the &#8220;base controller&#8221; and have access to the common functionality.</p>
<p>This class could be located anywhere, but for organizational conventions we recommend it to be in the controllers folder, e.g. apps/controllers/ControllerBase.php. The bootstrap file must include this class:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">require</span> <span class="s2">&quot;../app/controllers/ControllerBase.php&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>The implementation of common components (actions, methods, properties etc.) resides in this file:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ControllerBase</span> <span class="k">extends</span> <span class="nx">Phalcon_Controller</span>
<span class="p">{</span>

  <span class="sd">/**</span>
<span class="sd">   * This action is available for multiple controllers</span>
<span class="sd">   */</span>
  <span class="k">function</span> <span class="nf">someAction</span><span class="p">()</span>
  <span class="p">{</span>

  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Any other controller now inherits from ControllerBase, automatically gaining access to the common components (discussed above):</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">UsersController</span> <span class="k">extends</span> <span class="nx">ControllerBase</span>
<span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


                    </div>
                  </div>
                </div>          
            </div>
          </td>  
        </tr>   
      </table>
    <div class="related">      
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="models.html" title="Working with Models"
             >next</a> |</li>
        <li class="right" >
          <a href="mvc.html" title="The MVC Architecture"
             >previous</a> |</li> 
      </ul>
    </div>
        <div id="footer">
             &copy; Copyright 2012, Phalcon Team.
             Last updated on Aug 30, 2012.
            Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
        </div>

    </div>

  </body>
</html>